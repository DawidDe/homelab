---
- name: Bootstrap Os
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Retrieve Vars
      set_fact:
        secrets: "{{ lookup('hashi_vault', 'secret=kv/data/' ~ name ~ '-infra engine_mount_point=kv token=' ~ vault_token ~ ' url=' ~ vault_address) }}"
    - name: Set Facts
      set_fact:
        idrac_ip: "{{ secrets.idrac_ip }}"
        idrac_user: "{{ secrets.idrac_user }}"
        idrac_password: "{{ secrets.idrac_password }}"
    - name: Boot Server to ISO
      dellemc.openmanage.idrac_os_deployment:
        idrac_ip: "{{ idrac_ip }}"
        idrac_user: "{{ idrac_user }}"
        idrac_password: "{{ idrac_password }}"
        validate_certs: false
        share_name: "192.168.178.45:/home/dawid/homelab/base/iso"
        iso_image: "proxmox.iso"
        expose_duration: 180